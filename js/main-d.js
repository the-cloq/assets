document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("settings"),t=document.getElementById("submitBtn"),n=e.querySelectorAll('input:not([name="view-mode"])'),o=document.querySelectorAll(".slider_wrap div"),d=document.getElementById("dial"),i=document.getElementById("display-priceperkwh"),s=document.getElementById("priceperkwh"),a=document.getElementById("brightness"),r=document.getElementById("sensor_timer"),l=document.getElementById("summer_offset"),u=document.getElementById("winter_offset"),c=document.getElementById("cool"),m=document.getElementById("warm"),p=document.getElementById("hot"),y=a.value,f=r.value,v=l.value,g=u.value,h=c.value,E=m.value,I=p.value;let w=new Map;const x=[{id:"slider1",start:[y],range:{min:0,max:50},inputId:"brightness",padding:[1,0]},{id:"slider2",start:[f],range:{min:0,max:15},inputId:"sensor_timer",padding:[1,0]},{id:"slider3",start:[h,E,I],range:{min:0,max:40},inputIds:["cool","warm","hot"],connect:[!0,!0,!0,!0],padding:[0,0]},{id:"slider4",start:[v],range:{min:-12,max:12},inputId:"summer_offset",padding:[1,1]},{id:"slider5",start:[g],range:{min:-12,max:12},inputId:"winter_offset",padding:[1,1]}];o.forEach(((e,t)=>{const n=x[t];noUiSlider.create(e,{start:n.start,range:n.range,tooltips:!0,connect:n.connect||[!0,!1],padding:n.padding||[0,0],format:{to:e=>Math.round(e),from:e=>Number(e)}}),w.set(e,e.noUiSlider.get()),Array.isArray(n.inputIds)?e.noUiSlider.on("update",(function(e){n.inputIds.forEach(((t,n)=>{document.getElementById(t).value=e[n]}))})):e.noUiSlider.on("update",(function(e){document.getElementById(n.inputId).value=e})),Array.isArray(n.inputIds)?n.inputIds.forEach((t=>{document.getElementById(t).addEventListener("input",(function(){let t=n.inputIds.map((e=>document.getElementById(e).value));e.noUiSlider.set(t),T()}))})):document.getElementById(n.inputId).addEventListener("input",(function(){e.noUiSlider.set(this.value),T()}))})),n.forEach((e=>{w.set(e,"checkbox"===e.type||"radio"===e.type?e.checked:e.value)}));const B=30,L=.01,S=Math.round(1/L)+1,b=3*S*B;d.style.width=b+"px";let k=0,U=!1,X=0,A=0;const F=s.value;function _(e,t){return(e%t+t)%t}function M(e){let t=_(-e-S*B,b)+160;t=_(t,b);let n=Math.round(t/B);n%=S,n<0&&(n+=S);const o=n*L;i.textContent=o.toFixed(2)+"p",s.value=o.toFixed(2);const a=-(n*B-160)-S*B;return d.style.transform=`translateX(${a}px)`,k=a,T(),n}function $(e){U=!0,X=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX,A=k,d.style.transition="none",e.preventDefault()}function C(e){if(!U)return;const t=e.type.startsWith("touch")?e.touches[0].clientX:e.clientX;k=A+(t-X),d.style.transform=`translateX(${k}px)`,M(k)}function D(){if(!U)return;U=!1;let e=M(k)*B-160;e+=S*B,k=-e,d.style.transition="transform 0.3s ease-out",d.style.transform=`translateX(${k}px)`}let N;w.set(s,F),function(){for(let e=0;e<3;e++)for(let e=0;e<S;e++){const t=document.createElement("div");t.className="tick";const n=e*L;e%5==0?t.textContent=n.toFixed(2):t.classList.add("hide-label"),d.appendChild(t)}}(),function(){const e=parseFloat(s.value)||0,t=Math.round(e/L);k=-(t*B-160)-S*B,d.style.transform=`translateX(${k}px)`,M(k)}(),d.addEventListener("mousedown",$),d.addEventListener("touchstart",$,{passive:!1}),window.addEventListener("mousemove",C),window.addEventListener("touchmove",C,{passive:!1}),window.addEventListener("mouseup",D),window.addEventListener("touchend",D);let O=!1;function T(){let e=!1;n.forEach((t=>{w.get(t)!==("checkbox"===t.type||"radio"===t.type?t.checked:t.value)&&(e=!0)})),o.forEach((t=>{JSON.stringify(t.noUiSlider.get())!==JSON.stringify(w.get(t))&&(e=!0)})),s.value!==w.get(s)&&(e=!0),e?("none"!==t.style.display&&""!==t.style.display||(t.style.display="flex"),requestAnimationFrame((()=>{t.style.opacity="1",t.style.transform="scale(1.2)",O||(t.classList.add("expanded"),clearTimeout(N),N=setTimeout((()=>{t.classList.remove("expanded")}),3e3),O=!0)}))):(t.style.opacity="0",t.style.transform="scale(1)",O=!1)}n.forEach((e=>e.addEventListener("input",T))),o.forEach((e=>e.noUiSlider.on("update",T)));const q=document.getElementById("overlay");e&&t&&q&&e.addEventListener("submit",(function(n){n.preventDefault(),t.style.display="none",q.classList.add("reveal"),t.disabled=!0;const o=new FormData(e);fetch(e.action,{method:"POST",body:o}).then((e=>{if(!e.ok)throw new Error(`Server responded with status ${e.status}`);return e.text()})).then((e=>{setTimeout((()=>{window.location.reload()}),300)})).catch((e=>{console.error("Form submission error:",e),q.classList.remove("reveal"),t.style.display="flex",t.disabled=!1}))}))}));
