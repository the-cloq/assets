document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("settings"),t=document.getElementById("submitBtn"),n=e.querySelectorAll("input"),o=document.querySelectorAll(".slider_wrap div");var a=document.getElementById("brightness"),s=document.getElementById("sensor_timer"),i=document.getElementById("summer_offset"),r=document.getElementById("winter_offset"),c=document.getElementById("cool"),d=document.getElementById("warm"),l=document.getElementById("hot"),u=a.value,m=s.value,f=i.value,g=r.value,y=c.value,h=d.value,p=l.value;let v=new Map;const E=[{id:"slider1",start:[u],range:{min:0,max:50},inputId:"brightness",padding:[1,0]},{id:"slider2",start:[m],range:{min:0,max:15},inputId:"sensor_timer",padding:[1,0]},{id:"slider3",start:[y,h,p],range:{min:0,max:40},inputIds:["cool","warm","hot"],connect:[!0,!0,!0,!0],padding:[0,0]},{id:"slider4",start:[f],range:{min:-12,max:12},inputId:"summer_offset",padding:[1,1]},{id:"slider5",start:[g],range:{min:-12,max:12},inputId:"winter_offset",padding:[1,1]}];function I(){let e=!1;n.forEach((t=>{"view-mode"!==t.name&&v.get(t)!==("checkbox"===t.type||"radio"===t.type?t.checked:t.value)&&(e=!0)})),o.forEach((t=>{JSON.stringify(t.noUiSlider.get())!==JSON.stringify(v.get(t))&&(e=!0)})),e?"none"===t.style.display||""===t.style.display?(t.style.display="block",requestAnimationFrame((()=>{t.style.opacity="1",t.style.transform="scale(1.2)"}))):(t.style.opacity="1",t.style.transform="scale(1.2)"):(t.style.opacity="0",t.style.transform="scale(1)")}o.forEach(((e,t)=>{const n=E[t];noUiSlider.create(e,{start:n.start,range:n.range,tooltips:!0,connect:n.connect||[!0,!1],padding:n.padding||[0,0],format:{to:e=>Math.round(e),from:e=>Number(e)}}),v.set(e,e.noUiSlider.get()),Array.isArray(n.inputIds)?e.noUiSlider.on("update",(function(e){n.inputIds.forEach(((t,n)=>{document.getElementById(t).value=e[n]}))})):e.noUiSlider.on("update",(function(e){document.getElementById(n.inputId).value=e})),Array.isArray(n.inputIds)?n.inputIds.forEach(((t,o)=>{document.getElementById(t).addEventListener("input",(function(){let t=n.inputIds.map((e=>document.getElementById(e).value));e.noUiSlider.set(t),I()}))})):document.getElementById(n.inputId).addEventListener("input",(function(){e.noUiSlider.set(this.value),I()}))})),n.forEach((e=>{v.set(e,"checkbox"===e.type||"radio"===e.type?e.checked:e.value)})),n.forEach((e=>e.addEventListener("input",I))),o.forEach((e=>e.noUiSlider.on("update",I)))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("settings"),t=document.getElementById("submitBtn"),n=document.getElementById("overlay");e&&t&&n?(t.classList.add("hidden"),e.addEventListener("submit",(function(o){o.preventDefault(),t.classList.add("hidden"),t.disabled=!0,n.classList.add("reveal");const a=new FormData(e);fetch(e.action,{method:"POST",body:a}).then((e=>{if(!e.ok)throw new Error(`Server responded with status ${e.status}`);return e.text()})).then((e=>{setTimeout((()=>{window.location.reload()}),300)})).catch((e=>{console.error("Form submission error:",e),n.classList.remove("reveal"),t.classList.remove("hidden"),t.disabled=!1}))}))):console.error("Required elements not found.")}));const celciusRadio=document.getElementById("celcius"),fahrenheitRadio=document.getElementById("fahrenheit"),cel=document.getElementById("cel"),fah=document.getElementById("fah");function tempToggleBoxes(){cel.style.display=celciusRadio.checked?"block":"none",fah.style.display=fahrenheitRadio.checked?"block":"none"}document.querySelectorAll(".temp-toggles .radio-input").forEach((e=>{e.addEventListener("change",tempToggleBoxes)})),tempToggleBoxes();const summerRadio=document.getElementById("summer"),winterRadio=document.getElementById("winter"),sumR=document.getElementById("sumR"),wintR=document.getElementById("wintR");function dstToggleBoxes(){sumR.style.display=summerRadio.checked?"block":"none",wintR.style.display=winterRadio.checked?"block":"none"}function removeSpaces(e){return e.split(" ").join("")}function removeSpaceAfterComma(e){return e.replace(", ",",")}function update(){Math.floor((new Date).getTime()/1e3),document.body.className="darkmode",requestAnimationFrame(update)}document.querySelectorAll(".dst-toggles .radio-input").forEach((e=>{e.addEventListener("change",dstToggleBoxes)})),dstToggleBoxes(),function(){"use strict";document.getElementById("tabs");var e=document.querySelectorAll(".tab_panel"),t=document.querySelectorAll(".tab_heading"),n=[].slice.call(e);function o(e,n){n.forEach((function(n,o,a){n!==e?(n.setAttribute("aria-hidden",!0),t[o].setAttribute("aria-selected",!1)):(n.setAttribute("aria-hidden",!1),t[o].setAttribute("aria-selected",!0))}))}function a(e){var t=e.target.getAttribute("aria-controls");o(document.querySelector("#"+t),n),localStorage.setItem("lastTab",t)}[].slice.call(t),t.forEach((function(e,t,n){e.addEventListener("click",a)})),localStorage.length>0&&o(document.getElementById(localStorage.getItem("lastTab")),n)}(),Date.prototype.stdTimezoneOffset=function(){var e=new Date(this.getFullYear(),0,1),t=new Date(this.getFullYear(),6,1);return Math.max(e.getTimezoneOffset(),t.getTimezoneOffset())},Date.prototype.isDstObserved=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()},requestAnimationFrame(update);const accordionBtns=document.querySelectorAll(".accordion");accordionBtns.forEach((e=>{e.onclick=function(){this.classList.toggle("is-open");let e=this.nextElementSibling;console.log(e),e.style.maxHeight?e.style.maxHeight=null:(e.style.maxHeight=e.scrollHeight+"px",console.log(e.style.maxHeight))}}));const fanenContent=document.querySelector(".fanen-content"),faner=document.querySelectorAll(".fanen"),tabIndicator=document.querySelector(".fanen-indicator");faner.forEach(((e,t)=>{e.addEventListener("click",(()=>{faner.forEach((e=>e.classList.remove("active"))),e.classList.add("active"),switchToTab(0===t?1:2)}))}));let startX=0,currentX=0,startY=0,isSwiping=!1,hasDragged=!1,dragThreshold=20;function startSwipe(e){startX=e.touches?e.touches[0].clientX:e.clientX,startY=e.touches?e.touches[0].clientY:e.clientY,isSwiping=!0,hasDragged=!1}function moveSwipe(e){if(!isSwiping)return;currentX=e.touches?e.touches[0].clientX:e.clientX;const t=currentX-startX,n=(e.touches?e.touches[0].clientY:e.clientY)-startY;Math.abs(t)>dragThreshold&&Math.abs(t)>Math.abs(n)&&(hasDragged=!0,e.preventDefault(),fanenContent.style.transition="none",fanenContent.style.transform=`translateX(${getCurrentOffset()+t}px)`)}function endSwipe(e){if(!isSwiping)return;const t=currentX-startX;hasDragged&&(t>50?switchToTab(1):t<-50?switchToTab(2):resetPosition()),isSwiping=!1,hasDragged=!1}function switchToTab(e){1===e?(fanenContent.classList.remove("tab2-active"),fanenContent.classList.add("tab1-active"),tabIndicator.style.transform="translateX(0)"):(fanenContent.classList.remove("tab1-active"),fanenContent.classList.add("tab2-active"),tabIndicator.style.transform="translateX(100%)"),fanenContent.style.transition="transform 0.2s ease-in-out",fanenContent.style.transform=0===getCurrentOffset()?"translateX(0)":"translateX(-50%)"}function getCurrentOffset(){return fanenContent.classList.contains("tab1-active")?0:-fanenContent.clientWidth/2}function resetPosition(){fanenContent.style.transition="transform 0.2s ease-in-out",fanenContent.style.transform=0===getCurrentOffset()?"translateX(0)":"translateX(-50%)"}function flipCard(){document.getElementById("flipCard").classList.toggle("flip")}function loadSystemInfo(){fetch("/system-info").then((e=>e.json())).then((e=>{const t=e.freeHeap,n=e.heapFragmentation,o=e.maxFreeBlockSize,a=(e.uptime,Math.min(t/5e4*100,100)),s=Math.min(n/50*100,100),i=Math.min(o/5e4*100,100);document.getElementById("heapFill").style.height=`${a}%`,document.getElementById("heapValue").textContent=(t/1024).toFixed(1)+"kb";const r=document.getElementById("fragFill");r.style.height=`${s}%`,document.getElementById("fragValue").textContent=n+"%",r.style.background=n>50?"linear-gradient(to top, #f44336, #e57373)":n>30?"linear-gradient(to top, #ff9800, #ffc107)":"#00FFFF",document.getElementById("blockFill").style.height=`${i}%`,document.getElementById("blockValue").textContent=(o/1024).toFixed(1)+"kb";const c=document.getElementById("memoryStatusText");n>50?(c.textContent="Poor",c.style.color="red"):n>30?(c.textContent="Warning",c.style.color="orange"):(c.textContent="Excellent",c.style.color="#ffffff"),adjustBarLabels()})).catch((e=>console.error(e)))}function adjustBarLabels(){document.querySelectorAll(".bar-fill").forEach((e=>{const t=e.querySelector(".bar-value");e.offsetHeight<30?(t.style.position="absolute",t.style.bottom="100%",t.style.marginBottom="5px",t.style.color="white"):(t.style.position="static",t.style.marginBottom="5px",t.style.color="black")}))}fanenContent.addEventListener("touchstart",startSwipe,{passive:!1}),fanenContent.addEventListener("touchmove",moveSwipe,{passive:!1}),fanenContent.addEventListener("touchend",endSwipe),fanenContent.addEventListener("pointerdown",startSwipe),fanenContent.addEventListener("pointermove",moveSwipe),fanenContent.addEventListener("pointerup",endSwipe),document.addEventListener("DOMContentLoaded",(function(){!function(){const e=document.getElementById("location"),t=document.getElementById("apikey"),n=document.getElementById("submit-location");n.style.display="none";const o=e.value.trim();e.addEventListener("input",(function(){e.value.trim()!==o?n.style.display="block":n.style.display="none"})),document.getElementById("curve"),document.getElementById("title_");const a=document.getElementById("first-event"),s=document.getElementById("second-event"),i=document.getElementById("sunlight-hours-time");let r,c,d;function l(e){return e&&""!==e.trim()&&e.includes(",")}function u(){n.disabled=!l(e.value)}function m(e){return`${String(e.getUTCHours()).padStart(2,"0")}:${String(e.getUTCMinutes()).padStart(2,"0")}`}function f(e,t){const n=document.getElementById("curve");if(!n||!e)return;const o=n.getTotalLength(),a=n.getPointAtLength(t*o);e.setAttribute("cx",a.x),e.setAttribute("cy",a.y)}function g(){if(!r||!c)return;const e=document.getElementById("sunSVG"),t=(document.getElementById("sunMotion"),document.getElementById("sunriseMarker")),n=document.getElementById("sunsetMarker");if(!e||!t||!n)return void console.warn("Missing SVG elements needed for animation");function o(){const t=new Date,n=new Date(t.getTime()+1e3*d),o=(3600*n.getUTCHours()+60*n.getUTCMinutes()+n.getUTCSeconds())/86400;let a=e.querySelector("animateMotion");const s=document.createElementNS("http://www.w3.org/2000/svg","animateMotion");s.setAttribute("id","sunMotion"),s.setAttribute("begin","0s"),s.setAttribute("dur","24h"),s.setAttribute("repeatCount","indefinite"),s.setAttribute("path","M0 69.8975C56.1994 69.8975 111.319 3 167.541 3C227.168 3 274.438 69.8975 335 69.8975"),s.setAttribute("keyPoints",`${o};1`),s.setAttribute("keyTimes","0;1"),s.setAttribute("calcMode","linear"),a&&e.removeChild(a),e.appendChild(s),n>=r&&n<c?e.setAttribute("fill","#FFC300"):e.setAttribute("fill","#777777"),function(e){const t=document.querySelector(".box-large");if(!t||!r||!c)return;const n=12e5,o=new Date(r.getTime()-n),a=new Date(c.getTime()+n);t.style.backgroundColor=e>=o&&e<r?"#ff06bb0a":e>=r&&e<c?"#ffffff0a":e>=c&&e<a?"#ff06bb0a":"#00000026"}(n),console.log(`Updated sun position to ${o.toFixed(4)} of day`)}f(t,(3600*r.getUTCHours()+60*r.getUTCMinutes())/86400),f(n,(3600*c.getUTCHours()+60*c.getUTCMinutes())/86400),o(),e.dataset.updateIntervalId&&clearInterval(parseInt(e.dataset.updateIntervalId));const a=setInterval(o,3e4);e.dataset.updateIntervalId=a}async function y(){try{const o=document.getElementById("sunSVG");o&&o.dataset.updateIntervalId&&(clearInterval(parseInt(o.dataset.updateIntervalId)),o.dataset.updateIntervalId=""),a&&(a.textContent=""),s&&(s.textContent=""),i&&(i.textContent=""),n&&(n.disabled=!0);const l=e.value,f=t.value,[y,h]=l.split(",").map((e=>e.trim())),p=`https://api.openweathermap.org/data/2.5/weather?q=${y},${h}&appid=${f}`,v=await fetch(p);if(!v.ok)throw new Error(`Weather API returned ${v.status}: ${v.statusText}`);const E=await v.json(),I=E.sys.sunrise,b=E.sys.sunset;return d=E.timezone,function(e){const t=document.getElementById("timezoneOffset");if(!t)return;const n=(e-60*-(new Date).getTimezoneOffset())/3600;if(0===n)t.textContent="";else{const e=n>0?"+":"";t.textContent=`${e}${n}`}}(d),r=new Date(1e3*(I+d)),c=new Date(1e3*(b+d)),function(){if(!(r&&c&&a&&s))return;const e=new Date,t=new Date(e.getTime()+1e3*d),n=t<r,o=t>c,i=new Date(r.getTime()+12e4),l=new Date(c.getTime()+12e4),u=document.getElementById("first-event"),f=document.getElementById("second-event");function g(e,t){e&&(e.classList.add("hide"),setTimeout((()=>{e.innerHTML=t,e.classList.remove("hide"),e.classList.add("show")}),500))}n?(g(u,`<span>Sunrise</span> ${m(r)}`),g(f,`<span>Sunset</span> ${m(c)}`)):o?(g(u,`<span>Sunrise Tomorrow</span> ${m(i)}`),g(f,`<span>Sunset Tomorrow</span> ${m(l)}`)):(g(u,`<span>Sunset</span> ${m(c)}`),g(f,`<span>Sunrise Tomorrow</span> ${m(i)}`))}(),function(){if(!r||!c||!i)return;const e=(c-r)/1e3,t=Math.floor(e/3600),n=Math.floor(e%3600/60);i.textContent=`Total daylight hours ${t}hrs ${n}mins`}(),function(e){if(!e||!e.main||!e.main.temp)return;const t=e.main.temp,n=Math.round(t-273.15),o=Math.round(9*(t-273.15)/5+32),a=document.querySelector("#cel h4"),s=document.querySelector("#fah h4");a&&(a.innerHTML=`${n} <span>C</span>`),s&&(s.innerHTML=`${o} <span>F</span>`);const i=document.getElementById("conditions");if(i&&e.weather&&e.weather[0]){const t=e.weather[0].icon,n=e.weather[0].description;i.innerHTML=`<img src="https://openweathermap.org/img/wn/${t}@2x.png" \n                       alt="${n}" \n                       title="${n}"\n                       style="width: 50px; height: 50px;">`}}(E),function(e){const t=document.getElementById("location"),n=document.getElementById("localTime");if(!t||!n)return;const o=t.textContent;function a(){const t=new Date,a=new Date(t.getTime()+1e3*e),s=new Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",timeZone:"UTC"}).format(a);n.textContent=`${o} ${s}`}a(),n.dataset.timeIntervalId&&clearInterval(n.dataset.timeIntervalId);const s=setInterval(a,6e4);n.dataset.timeIntervalId=s}(d),g(),u(),!0}catch(e){return console.error("Error fetching weather data:",e),alert("Failed to fetch weather data. Please check your location input and try again."),u(),!1}}e.addEventListener("input",u),n.addEventListener("click",(function(){l(e.value)&&y()})),e.addEventListener("keyup",(function(e){"Enter"===e.key&&l(this.value)&&y()})),u(),l(e.value)&&y()}()}));const accordion=document.querySelector(".accordion"),header=accordion.querySelector(".accordion-header");function fetchUptimeHistory(){fetch("/uptime-history").then((e=>e.json())).then((e=>{const t=document.querySelector(".bar-container");t.innerHTML="";const n=Math.max(...e.days),o=e.avg,a=parseInt(localStorage.getItem("lastWeekAvg")||o);localStorage.setItem("lastWeekAvg",o),e.days.forEach((e=>{const o=document.createElement("div");o.className="bar",o.style.height=e/n*100+"%",o.dataset.min=e,t.appendChild(o)}));const s=o-a,i=0===s?"No change from last week.":s>0?`Up by ${s} minutes.`:`Down by ${Math.abs(s)} minutes.`;document.querySelector(".summary").textContent=`Weekly avg: ${o} min — ${i}`}))}header.addEventListener("click",(()=>{const e=accordion.querySelector(".accordion-content");accordion.classList.toggle("open"),accordion.classList.contains("open")?e.style.maxHeight=e.scrollHeight+"px":e.style.maxHeight="0"})),document.addEventListener("DOMContentLoaded",fetchUptimeHistory);
