document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("settings"),t=document.getElementById("submitBtn"),n=e.querySelectorAll("input"),a=document.querySelectorAll(".slider_wrap div");var o=document.getElementById("brightness"),s=document.getElementById("sensor_timer"),i=document.getElementById("summer_offset"),r=document.getElementById("winter_offset"),c=document.getElementById("cool"),d=document.getElementById("warm"),l=document.getElementById("hot"),u=o.value,m=s.value,f=i.value,g=r.value,p=c.value,h=d.value,y=l.value;let v=new Map;const I=[{id:"slider1",start:[u],range:{min:0,max:50},inputId:"brightness",padding:[1,0]},{id:"slider2",start:[m],range:{min:0,max:15},inputId:"sensor_timer",padding:[1,0]},{id:"slider3",start:[p,h,y],range:{min:0,max:40},inputIds:["cool","warm","hot"],connect:[!0,!0,!0,!0],padding:[0,0]},{id:"slider4",start:[f],range:{min:-12,max:12},inputId:"summer_offset",padding:[1,1]},{id:"slider5",start:[g],range:{min:-12,max:12},inputId:"winter_offset",padding:[1,1]}];function E(){let e=!1;n.forEach((t=>{v.get(t)!==("checkbox"===t.type||"radio"===t.type?t.checked:t.value)&&(e=!0)})),a.forEach((t=>{JSON.stringify(t.noUiSlider.get())!==JSON.stringify(v.get(t))&&(e=!0)})),e?"none"===t.style.display||""===t.style.display?(t.style.display="block",requestAnimationFrame((()=>{t.style.opacity="1",t.style.transform="scale(1.2)"}))):(t.style.opacity="1",t.style.transform="scale(1.2)"):(t.style.opacity="0",t.style.transform="scale(1)")}a.forEach(((e,t)=>{const n=I[t];noUiSlider.create(e,{start:n.start,range:n.range,tooltips:!0,connect:n.connect||[!0,!1],padding:n.padding||[0,0],format:{to:e=>Math.round(e),from:e=>Number(e)}}),v.set(e,e.noUiSlider.get()),Array.isArray(n.inputIds)?e.noUiSlider.on("update",(function(e){n.inputIds.forEach(((t,n)=>{document.getElementById(t).value=e[n]}))})):e.noUiSlider.on("update",(function(e){document.getElementById(n.inputId).value=e})),Array.isArray(n.inputIds)?n.inputIds.forEach(((t,a)=>{document.getElementById(t).addEventListener("input",(function(){let t=n.inputIds.map((e=>document.getElementById(e).value));e.noUiSlider.set(t),E()}))})):document.getElementById(n.inputId).addEventListener("input",(function(){e.noUiSlider.set(this.value),E()}))})),n.forEach((e=>{v.set(e,"checkbox"===e.type||"radio"===e.type?e.checked:e.value)})),n.forEach((e=>e.addEventListener("input",E))),a.forEach((e=>e.noUiSlider.on("update",E)))})),document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("settings"),t=document.getElementById("submitBtn"),n=document.getElementById("overlay");e&&t&&n?e.addEventListener("submit",(function(a){a.preventDefault(),t.style.display="none",n.classList.add("reveal"),t.disabled=!0;const o=new FormData(e);fetch(e.action,{method:"POST",body:o}).then((e=>{if(!e.ok)throw new Error(`Server responded with status ${e.status}`);return e.text()})).then((e=>{setTimeout((()=>{window.location.reload()}),300)})).catch((e=>{console.error("Form submission error:",e),n.classList.remove("reveal"),t.style.display="block",t.disabled=!1}))})):console.error("Required elements not found.")}));const celciusRadio=document.getElementById("celcius"),fahrenheitRadio=document.getElementById("fahrenheit"),cel=document.getElementById("cel"),fah=document.getElementById("fah");function tempToggleBoxes(){cel.style.display=celciusRadio.checked?"block":"none",fah.style.display=fahrenheitRadio.checked?"block":"none"}document.querySelectorAll(".temp-toggles .radio-input").forEach((e=>{e.addEventListener("change",tempToggleBoxes)})),tempToggleBoxes();const summerRadio=document.getElementById("summer"),winterRadio=document.getElementById("winter"),sumR=document.getElementById("sumR"),wintR=document.getElementById("wintR");function dstToggleBoxes(){sumR.style.display=summerRadio.checked?"block":"none",wintR.style.display=winterRadio.checked?"block":"none"}function removeSpaces(e){return e.split(" ").join("")}function removeSpaceAfterComma(e){return e.replace(", ",",")}function update(){Math.floor((new Date).getTime()/1e3),document.body.className="darkmode",requestAnimationFrame(update)}document.querySelectorAll(".dst-toggles .radio-input").forEach((e=>{e.addEventListener("change",dstToggleBoxes)})),dstToggleBoxes(),function(){"use strict";document.getElementById("tabs");var e=document.querySelectorAll(".tab_panel"),t=document.querySelectorAll(".tab_heading"),n=[].slice.call(e);function a(e,n){n.forEach((function(n,a,o){n!==e?(n.setAttribute("aria-hidden",!0),t[a].setAttribute("aria-selected",!1)):(n.setAttribute("aria-hidden",!1),t[a].setAttribute("aria-selected",!0))}))}function o(e){var t=e.target.getAttribute("aria-controls");a(document.querySelector("#"+t),n),localStorage.setItem("lastTab",t)}[].slice.call(t),t.forEach((function(e,t,n){e.addEventListener("click",o)})),localStorage.length>0&&a(document.getElementById(localStorage.getItem("lastTab")),n)}(),Date.prototype.stdTimezoneOffset=function(){var e=new Date(this.getFullYear(),0,1),t=new Date(this.getFullYear(),6,1);return Math.max(e.getTimezoneOffset(),t.getTimezoneOffset())},Date.prototype.isDstObserved=function(){return this.getTimezoneOffset()<this.stdTimezoneOffset()},requestAnimationFrame(update);const accordionBtns=document.querySelectorAll(".accordion");accordionBtns.forEach((e=>{e.onclick=function(){this.classList.toggle("is-open");let e=this.nextElementSibling;console.log(e),e.style.maxHeight?e.style.maxHeight=null:(e.style.maxHeight=e.scrollHeight+"px",console.log(e.style.maxHeight))}}));const fanenContent=document.querySelector(".fanen-content"),faner=document.querySelectorAll(".fanen"),tabIndicator=document.querySelector(".fanen-indicator");faner.forEach(((e,t)=>{e.addEventListener("click",(()=>{faner.forEach((e=>e.classList.remove("active"))),e.classList.add("active"),switchToTab(0===t?1:2)}))}));let startX=0,currentX=0,startY=0,isSwiping=!1,hasDragged=!1,dragThreshold=20;function startSwipe(e){startX=e.touches?e.touches[0].clientX:e.clientX,startY=e.touches?e.touches[0].clientY:e.clientY,isSwiping=!0,hasDragged=!1}function moveSwipe(e){if(!isSwiping)return;currentX=e.touches?e.touches[0].clientX:e.clientX;const t=currentX-startX,n=(e.touches?e.touches[0].clientY:e.clientY)-startY;Math.abs(t)>dragThreshold&&Math.abs(t)>Math.abs(n)&&(hasDragged=!0,e.preventDefault(),fanenContent.style.transition="none",fanenContent.style.transform=`translateX(${getCurrentOffset()+t}px)`)}function endSwipe(e){if(!isSwiping)return;const t=currentX-startX;hasDragged&&(t>50?switchToTab(1):t<-50?switchToTab(2):resetPosition()),isSwiping=!1,hasDragged=!1}function switchToTab(e){1===e?(fanenContent.classList.remove("tab2-active"),fanenContent.classList.add("tab1-active"),tabIndicator.style.transform="translateX(0)"):(fanenContent.classList.remove("tab1-active"),fanenContent.classList.add("tab2-active"),tabIndicator.style.transform="translateX(100%)"),fanenContent.style.transition="transform 0.2s ease-in-out",fanenContent.style.transform=0===getCurrentOffset()?"translateX(0)":"translateX(-50%)"}function getCurrentOffset(){return fanenContent.classList.contains("tab1-active")?0:-fanenContent.clientWidth/2}function resetPosition(){fanenContent.style.transition="transform 0.2s ease-in-out",fanenContent.style.transform=0===getCurrentOffset()?"translateX(0)":"translateX(-50%)"}function flipCard(e){e.closest(".card").classList.toggle("flip")}function loadSystemInfo(){fetch("/system-info").then((e=>e.json())).then((e=>{let t="Unknown",n="#aaa";e.freeHeap>25e3?(t="Excellent",n="#00FF00"):e.freeHeap>15e3?(t="Good",n="#FFD700"):(t="Bad",n="#FF0000"),document.getElementById("sys-info").innerHTML=`\n          <h3>System and Memory Health</h3>\n          <div class="health_row" id="heap-status">\n            Free Heap <span>${e.freeHeap} bytes</span>\n          </div>\n          <div class="health_row">Heap Fragmentation <span>${e.heapFragmentation}%</span></div>\n          <div class="health_row">Max Free Block <span>${e.maxFreeBlockSize} bytes</span></div>\n          <div class="health_row">Uptime <span>${e.uptime}</span></div>\n          <div class="heap-status">Memory Status: <span style="color: ${n};">${t}</span></div>\n        `})).catch((e=>console.error(e)))}fanenContent.addEventListener("touchstart",startSwipe,{passive:!1}),fanenContent.addEventListener("touchmove",moveSwipe,{passive:!1}),fanenContent.addEventListener("touchend",endSwipe),fanenContent.addEventListener("pointerdown",startSwipe),fanenContent.addEventListener("pointermove",moveSwipe),fanenContent.addEventListener("pointerup",endSwipe),document.addEventListener("DOMContentLoaded",(function(){!function(){const e=document.getElementById("location"),t=document.getElementById("apikey"),n=document.getElementById("submit-location");n.style.display="none";const a=e.value.trim();e.addEventListener("input",(function(){e.value.trim()!==a?n.style.display="block":n.style.display="none"})),document.getElementById("curve"),document.getElementById("title_");const o=document.getElementById("first-event"),s=document.getElementById("second-event"),i=document.getElementById("sunlight-hours-time");let r,c,d;function l(e){return e&&""!==e.trim()&&e.includes(",")}function u(){n.disabled=!l(e.value)}function m(e){return`${String(e.getUTCHours()).padStart(2,"0")}:${String(e.getUTCMinutes()).padStart(2,"0")}`}function f(e,t){const n=document.getElementById("curve");if(!n||!e)return;const a=n.getTotalLength(),o=n.getPointAtLength(t*a);e.setAttribute("cx",o.x),e.setAttribute("cy",o.y)}function g(){if(!r||!c)return;const e=document.getElementById("sunSVG"),t=(document.getElementById("sunMotion"),document.getElementById("sunriseMarker")),n=document.getElementById("sunsetMarker");if(!e||!t||!n)return void console.warn("Missing SVG elements needed for animation");function a(){const t=new Date,n=new Date(t.getTime()+1e3*d),a=(3600*n.getUTCHours()+60*n.getUTCMinutes()+n.getUTCSeconds())/86400;let o=e.querySelector("animateMotion");const s=document.createElementNS("http://www.w3.org/2000/svg","animateMotion");s.setAttribute("id","sunMotion"),s.setAttribute("begin","0s"),s.setAttribute("dur","24h"),s.setAttribute("repeatCount","indefinite"),s.setAttribute("path","M0 69.8975C56.1994 69.8975 111.319 3 167.541 3C227.168 3 274.438 69.8975 335 69.8975"),s.setAttribute("keyPoints",`${a};1`),s.setAttribute("keyTimes","0;1"),s.setAttribute("calcMode","linear"),o&&e.removeChild(o),e.appendChild(s),n>=r&&n<c?e.setAttribute("fill","#FFC300"):e.setAttribute("fill","#777777"),function(e){const t=document.querySelector(".box-large");if(!t||!r||!c)return;const n=12e5,a=new Date(r.getTime()-n),o=new Date(c.getTime()+n);t.style.backgroundColor=e>=a&&e<r?"#ff06bb0a":e>=r&&e<c?"#ffffff0a":e>=c&&e<o?"#ff06bb0a":"#00000026"}(n),console.log(`Updated sun position to ${a.toFixed(4)} of day`)}f(t,(3600*r.getUTCHours()+60*r.getUTCMinutes())/86400);f(n,(3600*c.getUTCHours()+60*c.getUTCMinutes())/86400),a(),e.dataset.updateIntervalId&&clearInterval(parseInt(e.dataset.updateIntervalId));const o=setInterval(a,3e4);e.dataset.updateIntervalId=o}async function p(){try{const a=document.getElementById("sunSVG");a&&a.dataset.updateIntervalId&&(clearInterval(parseInt(a.dataset.updateIntervalId)),a.dataset.updateIntervalId=""),o&&(o.textContent=""),s&&(s.textContent=""),i&&(i.textContent=""),n&&(n.disabled=!0);const l=e.value,f=t.value,[p,h]=l.split(",").map((e=>e.trim())),y=`https://api.openweathermap.org/data/2.5/weather?q=${p},${h}&appid=${f}`,v=await fetch(y);if(!v.ok)throw new Error(`Weather API returned ${v.status}: ${v.statusText}`);const I=await v.json(),E=I.sys.sunrise,w=I.sys.sunset;return d=I.timezone,function(e){const t=document.getElementById("timezoneOffset");if(!t)return;const n=(e-60*-(new Date).getTimezoneOffset())/3600;if(0===n)t.textContent="";else{const e=n>0?"+":"";t.textContent=`${e}${n}`}}(d),r=new Date(1e3*(E+d)),c=new Date(1e3*(w+d)),function(){if(!(r&&c&&o&&s))return;const e=new Date,t=new Date(e.getTime()+1e3*d),n=t<r,a=t>c,i=new Date(r.getTime()+12e4),l=new Date(c.getTime()+12e4),u=document.getElementById("first-event"),f=document.getElementById("second-event");function g(e,t){e&&(e.classList.add("hide"),setTimeout((()=>{e.innerHTML=t,e.classList.remove("hide"),e.classList.add("show")}),500))}n?(g(u,`<span>Sunrise</span> ${m(r)}`),g(f,`<span>Sunset</span> ${m(c)}`)):a?(g(u,`<span>Sunrise Tomorrow</span> ${m(i)}`),g(f,`<span>Sunset Tomorrow</span> ${m(l)}`)):(g(u,`<span>Sunset</span> ${m(c)}`),g(f,`<span>Sunrise Tomorrow</span> ${m(i)}`))}(),function(){if(!r||!c||!i)return;const e=(c-r)/1e3,t=Math.floor(e/3600),n=Math.floor(e%3600/60);i.textContent=`Total daylight hours ${t}hrs ${n}mins`}(),function(e){if(!e||!e.main||!e.main.temp)return;const t=e.main.temp,n=Math.round(t-273.15),a=Math.round(9*(t-273.15)/5+32),o=document.querySelector("#cel h4"),s=document.querySelector("#fah h4");o&&(o.innerHTML=`${n} <span>C</span>`);s&&(s.innerHTML=`${a} <span>F</span>`);const i=document.getElementById("conditions");if(i&&e.weather&&e.weather[0]){const t=e.weather[0].icon,n=e.weather[0].description;i.innerHTML=`<img src="https://openweathermap.org/img/wn/${t}@2x.png" \n                       alt="${n}" \n                       title="${n}"\n                       style="width: 50px; height: 50px;">`}}(I),function(e){const t=document.getElementById("location"),n=document.getElementById("localTime");if(!t||!n)return;const a=t.textContent;function o(){const t=new Date,o=new Date(t.getTime()+1e3*e),s=new Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",timeZone:"UTC"}).format(o);n.textContent=`${a} ${s}`}o(),n.dataset.timeIntervalId&&clearInterval(n.dataset.timeIntervalId);const s=setInterval(o,6e4);n.dataset.timeIntervalId=s}(d),g(),u(),!0}catch(e){return console.error("Error fetching weather data:",e),alert("Failed to fetch weather data. Please check your location input and try again."),u(),!1}}e.addEventListener("input",u),n.addEventListener("click",(function(){l(e.value)&&p()})),e.addEventListener("keyup",(function(e){"Enter"===e.key&&l(this.value)&&p()})),u(),l(e.value)&&p()}()}));const accordion=document.querySelector(".accordion"),header=accordion.querySelector(".accordion-header");function fetchUptimeHistory(){fetch("/uptime-history").then((e=>e.json())).then((e=>{const t=document.querySelector(".bar-container");t.innerHTML="";const n=Math.max(...e.days),a=e.avg,o=parseInt(localStorage.getItem("lastWeekAvg")||a);localStorage.setItem("lastWeekAvg",a),e.days.forEach((e=>{const a=document.createElement("div");a.className="bar",a.style.height=e/n*100+"%",a.dataset.min=e,t.appendChild(a)}));const s=a-o,i=0===s?"No change from last week.":s>0?`Up by ${s} minutes.`:`Down by ${Math.abs(s)} minutes.`;document.querySelector(".summary").textContent=`Weekly avg: ${a} min — ${i}`}))}header.addEventListener("click",(()=>{const e=accordion.querySelector(".accordion-content");accordion.classList.toggle("open"),accordion.classList.contains("open")?e.style.maxHeight=e.scrollHeight+"px":e.style.maxHeight="0"})),document.addEventListener("DOMContentLoaded",fetchUptimeHistory);
