document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("settings"),t=document.getElementById("submitBtn"),n=e.querySelectorAll('input:not([name="view-mode"])'),d=document.querySelectorAll(".slider_wrap div"),i=document.getElementById("brightness"),o=document.getElementById("sensor_timer"),a=document.getElementById("summer_offset"),r=document.getElementById("winter_offset"),s=document.getElementById("cool"),l=document.getElementById("warm"),u=document.getElementById("hot"),c=i.value,m=o.value,p=a.value,y=r.value,g=s.value,f=l.value,E=u.value;let v=new Map;const I=[{id:"slider1",start:[c],range:{min:0,max:50},inputId:"brightness",padding:[1,0]},{id:"slider2",start:[m],range:{min:0,max:15},inputId:"sensor_timer",padding:[1,0]},{id:"slider3",start:[g,f,E],range:{min:0,max:40},inputIds:["cool","warm","hot"],connect:[!0,!0,!0,!0],padding:[0,0]},{id:"slider4",start:[p],range:{min:-12,max:12},inputId:"summer_offset",padding:[1,1]},{id:"slider5",start:[y],range:{min:-12,max:12},inputId:"winter_offset",padding:[1,1]}];let h;d.forEach(((e,t)=>{const n=I[t];noUiSlider.create(e,{start:n.start,range:n.range,tooltips:!0,connect:n.connect||[!0,!1],padding:n.padding||[0,0],format:{to:e=>Math.round(e),from:e=>Number(e)}}),v.set(e,e.noUiSlider.get()),Array.isArray(n.inputIds)?e.noUiSlider.on("update",(function(e){n.inputIds.forEach(((t,n)=>{document.getElementById(t).value=e[n]}))})):e.noUiSlider.on("update",(function(e){document.getElementById(n.inputId).value=e})),Array.isArray(n.inputIds)?n.inputIds.forEach((t=>{document.getElementById(t).addEventListener("input",(function(){let t=n.inputIds.map((e=>document.getElementById(e).value));e.noUiSlider.set(t),S()}))})):document.getElementById(n.inputId).addEventListener("input",(function(){e.noUiSlider.set(this.value),S()}))})),n.forEach((e=>{v.set(e,"checkbox"===e.type||"radio"===e.type?e.checked:e.value)}));let B=!1;function S(){let e=!1;n.forEach((t=>{v.get(t)!==("checkbox"===t.type||"radio"===t.type?t.checked:t.value)&&(e=!0)})),d.forEach((t=>{JSON.stringify(t.noUiSlider.get())!==JSON.stringify(v.get(t))&&(e=!0)})),e?("none"!==t.style.display&&""!==t.style.display||(t.style.display="flex"),requestAnimationFrame((()=>{t.style.opacity="1",t.style.transform="scale(1.2)",B||(t.classList.add("expanded"),clearTimeout(h),h=setTimeout((()=>{t.classList.remove("expanded")}),3e3),B=!0)}))):(t.style.opacity="0",t.style.transform="scale(1)",B=!1)}n.forEach((e=>e.addEventListener("input",S))),d.forEach((e=>e.noUiSlider.on("update",S)));const w=document.getElementById("overlay");e&&t&&w&&e.addEventListener("submit",(function(n){n.preventDefault(),t.style.display="none",w.classList.add("reveal"),t.disabled=!0;const d=new FormData(e);fetch(e.action,{method:"POST",body:d}).then((e=>{if(!e.ok)throw new Error(`Server responded with status ${e.status}`);return e.text()})).then((e=>{setTimeout((()=>{window.location.reload()}),300)})).catch((e=>{console.error("Form submission error:",e),w.classList.remove("reveal"),t.style.display="flex",t.disabled=!1}))}))}));
